---

layout: col-sidebar
title: "LCNC-SEC-02: 認可の誤用"

---

## リスク評価 [*](https://owasp.org/www-project-top-ten/2017/Note_About_Risks)

| 普及度 | 検出難易度 | 悪用難易度 | 技術的影響 |
| --- | --- | --- | --- |
| 3 | 3 | 3 | 3 |

## 要旨

コネクションはほとんどのローコード/ノーコードプラットフォームでファーストクラスのオブジェクトです。
これはアプリケーション、他のユーザー、組織全体の間でコネクションが確立され、アプリケーションが削除されてもコネクションが「オン」のままとなることを意味します。
また、アプリケーションはその基盤となるデータにアクセスすべきでないユーザーと共有できてしまいます。
さらに、アプリケーションはユースケースの要件を超える幅広い認可スコープをもつこともあります。

## 説明

ローコード/ノーコード開発はサイロ (縦割り組織) で行われるものではありません。
その影響はオンプレミス、SaaS、PaaS、クラウドプラットフォームにまたがり統合された組織のスタック全体に及びます。
ほとんどのローコード/ノーコードプラットフォームには多数のコネクタセット、つまり API のラッパーが多数組み込まれており、すばやく簡単に接続できます。
コネクタとユーザー資格情報はコネクションを形成し、ほとんどのローコード/ノーコードプラットフォームで主にファーストクラスのオブジェクトとなります。
これはアプリケーション間、他のユーザー、または組織全体でコネクションが共有できることを意味します。

多くのローコード/ノーコードプラットフォームは OAuth 認証フローを悪用して、ユーザーリフレッシュトークンをクエリして保存し、それらを勝手に再利用することで生産性を高め、配信までの時間を短縮しています。
これによりビジネスユーザーはシークレットやパーミッションについて考えることなくコネクションをすばやく設定できますが、同時に、コネクションには監視や取消が難しいユーザー ID が組み込まれてしまいます。
OAuth リフレッシュトークンは有効期限が短くなるように設計されていますが、ほとんどの場合、数か月から数年も有効であることがよくあります。
したがって、ビジネスユーザーが短時間で作成したコネクションは、ローコード/ノーコードプラットフォームで長期間存続し、他のユーザーによって本来の意図とは異なる目的で使用されることがよくあります。

認可スコープは組織のリソースや資産へのアクセスをコントロールします。
ローコード/ノーコード開発者はアプリケーションの認可スコープを幅広くし、できるだけ汎用的なものにすることを好みます。
組織にとっては、これによってアプリケーションを迅速かつ容易にセットアップでき、後で他のアプリケーションを必要とせずに他のユースケースに使用できます。
認可スコープを幅広くすることで、認可の誤用という不必要なリスクが伴います。

## 攻撃シナリオの例

### シナリオ #1

ある開発者は企業の電子メールアカウントへのコネクションを作成しました。
うっかり「全員で共有」オプションをクリックして、使用権限または完全な所有権のいずれかを付与してしまいます。
企業内のすべてのユーザー (請負業者やベンダーを含む) が企業の電子メールアカウントにアクセスできるようになります。
悪意のあるユーザーは「パスワードを忘れた場合」のフローをトリガーし、コネクションを使用してプロセスを実行し、アカウントをコントロールします。

### シナリオ #2

ある開発者はデータベースからレコードを閲覧するためのシンプルなアプリケーションを作成しました。
このアプリケーションは各ユーザーが関連するレコードのみを閲覧できるように権限を設定しています。
しかし、アプリケーションは基盤となるデータベースコネクションがそのユーザーと暗黙のうちに共有されるように設定されています。
アプリケーションのユーザーはデータベースコネクションを直接使用して、すべてのレコードへの完全なアクセスを取得できます。

### シナリオ #3

管理者はサービスアカウントまたはアプリケーションアカウントを使用してアプリケーションをソースコード管理システム (Bitbucket など) に接続します。
提供されたこのサービスアカウントまたはアプリケーションアカウントはシームレスな統合を可能にするためにすべてのリポジトリに無制限にアクセスできます。
内部ユーザーはこのコネクションを悪用して、通常はアクセスできない制限付きリポジトリにアクセスできます。

### シナリオ #4

ある開発者はあるプラットフォームから別のプラットフォームへフォームを送信するシンプルなアプリケーションを作成しました。
しかし、このアプリケーションはフォーム送信を作成するだけで十分なはずなのに、フォーム送信の編集と削除の認可を必要とするように設定されています。

## 防止方法

- 暗黙のうちに共有されるコネクションを使用できないようにするか、または監視する。
- 共有コネクションを含む可能性がある環境へのアクセスを提供する際には、最小権限の原則を遵守する。
- ノーコード/ローコードプラットフォームの過剰な共有コネクションを監視する。
- コネクション共有のリスクと資格情報共有との関係についてビジネスユーザーに教育する。
- コネクションを再認証することにより、OAuth トークンを定期的に明示的にリフレッシュする。
- アプリケーションが必要とするスコープを慎重にレビューし、最小権限の原則を順守する。


## 参考資料

- [Credential Sharing as a Service: The Hidden Risk of Low-Code/No-Code](https://www.darkreading.com/dr-tech/credential-sharing-as-a-service-hidden-risk-of-low-code-no-code)
- [Low-Code Platforms Are the New Holy Grail for Hackers](https://www.zenity.io/blog/why-are-low-code-platforms-becoming-the-new-holy-grail-of-cyberattackers/)
